---
id: db_overview
title: Database Overview
---

The database is an important component in the AEPsych project. It stores experiment metadata and also includes each message passed between the client and server, allowing previous experiments to be replayed trial-by-trial. The database is built using [SQL Alchemy](https://www.sqlalchemy.org/), which provides a one-to-one mapping to Python classes. The entire structure of the AEPsych Database implementation can be seen below in the following diagram:

![DB Diagram](assets/db_diagram.png)

It is important to read the diagram as follows: the primary table is in yellow with all child tables in blue. The green highlighted text represents the unique ID entry for that specific table. The yellow lightly highlighted text corresponds to a foreign key in the primary (yellow) table. 

The database contains four tables: one primary and three secondary tables. Each table is described as follows:

- **master Table**: This table is the primary table of AEPsych. This table stores information about each experiment and is used to link data stored in the other tables. The columns are described as followed:


|Master Table Column | Purpose|
|:-: | :- |
|unique_id | A unique ID generated for each entry in this table.|
|experiment_name | A name given to the experiment through the experiment's configuration file. If not specified, default value is set to "default name".|
|experiment_description | A set of text provided to describe the function of the experiment. This value is configurable in the experiment's configuration file. If not specified, default value is set to "default description".|
|experiment_id | A value distinguishing the specific experiment in question. This value utilizes the python Universal Unique Identifier module. If not specified in the experiment's configuration file, it will be automatically generated through the python module.|
|participant_id | A value specifying a particular user within an experiment (perfect for keeping track of more than one participant in an experiment). If not specified in the experiment's configuration file, it will be empty in the Database.|
| extra_metadata | Any special meta data specified in the configuration file under the section "Metadata". This is automatically generated into a JSON file so it may be serialized/deserialized easier at a later time period. If no metadata is specified in the configuration file, this field will be empty. |


- **replay_data Table**: The replay data table is essential for replaying experiments. It contains entries from each step of an experiment's trial so the replay functionality can work properly. The columns are described as followed:

|Replay Data Column | Purpose |
|:-: | :- |
|unique_id | A unique ID generated for each entry in this table. |
|timestamp | An identifier that specifies a timestamp of the specific entry. This field gives a chronological order for the replay to replay events. This field is populated each time a message is recorded from the server.  |
|message_type | This is the type of message generated by the server in this entry. These message types include _setup_, _ask_, and _tell_, among others.|
|message_contents | Contains the raw data in the message_content field of the message. This is stored as a BLOB in the database. This may be changed in future versions of AEPsych for the JSON format as it is easier to read. |
|extra_info | Extra information pertaining to the replay data. This is stored as a Python pickle for serialization/deserialization. This may change in the future for more preferred methods. |
|master_table_id | This is a reference key to the original entry in the master table's unique ID. |

- **strat_data table**: The strat_data table contains information pertaining to the choices of which strat is used during an experiment and stores information about such strats. The columns are described as followed:

|Strat Table Column | Purpose |
| :-: | :- |
|unique_id | A unique ID generated for each entry in this table. |
|timestamp | An identifier that specifies a timestamp of the specific entry. This field provides a chronological order for viewing the strat history. This field is usually populated when the experiment is completed, where it must save the strat, or the experiment is terminated and it stores the result of the strat. |
|strat| An entry that contains information about the strat. This information is stored as a Python pickle for easy serialization/deserialization. This may change in the future for more preferred methods. |
|master_table_id| This is a reference key to the original entry in the master table's unique ID.|

- **config Table**: This table stores information pertaining the configuration of the experiment. This includes experiment fields that the experiment relies on during trials and metadata information to aid in distinguishing similar experiments. The columns are described as  followed:

|Config Table Column | Purpose |
|:-: | :- |
|unique_id | A unique ID generated for each entry in this table. |
|timestamp | An identifier that specifies a timestamp of the specific entry. This field provides a chronological order in the viewing of configuration history. This field is usually updated on the setup of the AEPsych server when checking for an existing configuration. |
|config| An entry that contains the configuration itself. This information is stored as a Python pickle for easy serialization/deserialization. This may change in the future for more preferred methods. |
|master_table_id| This is a reference key to the original entry in the master table's unique ID.

The database is an integral part of the project and is constantly changing. In order to ease this functionality, the database is implemented through SQL Alchemy, which supports updates to the database. This functionality will help preserve backwards-compatibility across AEPsych versions. As more and more changes are made to the project, the update function in db.py must be configured. The best way to get started in exploring functionality of the database is by running the Interactive_AEPsych jupyter journal located in the [examples folder](https://github.com/facebookresearch/aepsych/tree/main/examples) of the root folder. 

