<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Database Overview · AEPsych</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The database is an important component in an AEPsych project. It stores experiment metadata and also includes each message passed between the client and server, allowing previous experiments to be replayed trial-by-trial. The database is built using [SQL Alchemy](https://www.sqlalchemy.org/). The entire structure of the AEPsych Database implementation can be seen below in the following diagram:"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Database Overview · AEPsych"/><meta property="og:type" content="website"/><meta property="og:url" content="https://aepsych.org/"/><meta property="og:description" content="The database is an important component in an AEPsych project. It stores experiment metadata and also includes each message passed between the client and server, allowing previous experiments to be replayed trial-by-trial. The database is built using [SQL Alchemy](https://www.sqlalchemy.org/). The entire structure of the AEPsych Database implementation can be seen below in the following diagram:"/><meta property="og:image" content="https://aepsych.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://aepsych.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/code_block_buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/cookie_consent.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/cookie_consent.js"></script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">AEPsych</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/api/" target="_self">API Reference</a></li><li class=""><a href="https://github.com/facebookresearch/aepsych" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>For developers</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">About</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/papers">Papers related to AEPsych</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">General</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting_started">Getting Started with the AEPsych service</a></li><li class="navListItem"><a class="navItem" href="/docs/configs">Writing Config Files</a></li><li class="navListItem"><a class="navItem" href="/docs/clients">AEPsych clients</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Background materials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/psychophysics_intro">A brief introduction to Psychophysics</a></li><li class="navListItem"><a class="navItem" href="/docs/gp_intro">A brief introduction to Gaussian Process active learning</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For developers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api_overview">API Overview</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/db_overview">Database Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced topics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/finish_criteria">Advanced Strategy Configuration</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebookresearch/aepsych/blob/main/docs/db_overview.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Database Overview</h1></header><article><div><span><p>The database is an important component in an AEPsych project. It stores experiment metadata and also includes each message passed between the client and server, allowing previous experiments to be replayed trial-by-trial. The database is built using <a href="https://www.sqlalchemy.org/">SQL Alchemy</a>. The entire structure of the AEPsych Database implementation can be seen below in the following diagram:</p>
<p><img src="/docs/assets/db_diagram.png" alt="DB Diagram"></p>
<p>In this diagram, the primary table is in yellow with all child tables in blue. The green-highlighted text represents the unique ID entry for that specific table. The yellow-highlighted text corresponds to a foreign key in the primary (yellow) table.</p>
<p>The database contains four tables: one primary and three secondary tables. Each table is described as follows:</p>
<ul>
<li><strong>master Table</strong>: This table is the primary table of AEPsych. This table stores information about each experiment and is used to link data stored in the other tables. The columns are described as followed:</li>
</ul>
<table>
<thead>
<tr><th style="text-align:center">Master Table Column</th><th style="text-align:left">Purpose</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">unique_id</td><td style="text-align:left">A unique ID generated for each entry in this table.</td></tr>
<tr><td style="text-align:center">experiment_name</td><td style="text-align:left">A name given to the experiment through the experiment's configuration file. If not specified, defaults to &quot;default name&quot;.</td></tr>
<tr><td style="text-align:center">experiment_description</td><td style="text-align:left">A text description of the experiment. This value is configurable in the experiment's configuration file. If not specified, defaults to &quot;default description&quot;.</td></tr>
<tr><td style="text-align:center">experiment_id</td><td style="text-align:left">A unique ID for an experiment. If not specified in the experiment's configuration file, it will be automatically generated through the Python's <a href="https://docs.python.org/3/library/uuid.html">Unique Universal Identifier</a> module.</td></tr>
<tr><td style="text-align:center">participant_id</td><td style="text-align:left">A unique ID for a specific participant in an experiment. If not specified in the experiment's configuration file, it will be left empty.</td></tr>
<tr><td style="text-align:center">extra_metadata</td><td style="text-align:left">Any special metadata specified in the configuration file under the section &quot;Metadata&quot;. This metadata is stored as JSON so that it may be easily serialized/deserialized at a later time period. If no metadata is specified in the configuration file, this field will be empty.</td></tr>
</tbody>
</table>
<ul>
<li><strong>replay_data Table</strong>: The replay table contains the messages sent between the client and the server on each trial so that previous experiments can be replayed again. The columns are described as followed:</li>
</ul>
<table>
<thead>
<tr><th style="text-align:center">Replay Data Column</th><th style="text-align:left">Purpose</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">unique_id</td><td style="text-align:left">A unique ID generated for each entry in this table.</td></tr>
<tr><td style="text-align:center">timestamp</td><td style="text-align:left">A timestamp indicating when the server sent or received a message. This column can be used to view messages in chronological order.</td></tr>
<tr><td style="text-align:center">message_type</td><td style="text-align:left">The type of message. These message types include <em>setup</em>, <em>ask</em>, and <em>tell</em>, among others.</td></tr>
<tr><td style="text-align:center">message_contents</td><td style="text-align:left">Contains the raw data in the message_content field of the message. This is stored as a BLOB in the database (This may be changed to JSON in the future).</td></tr>
<tr><td style="text-align:center">extra_info</td><td style="text-align:left">Extra information pertaining to the replay data. This is stored as a Python pickle object for serialization/deserialization (This may change in the future as Python pickle objects may not load across versions of Python or AEPsych).</td></tr>
<tr><td style="text-align:center">master_table_id</td><td style="text-align:left">A reference key to the original entry in the master table's unique ID.</td></tr>
</tbody>
</table>
<ul>
<li><strong>strat_data table</strong>: The strat_data table stores the saved AEPsych Strategies, which contain the experiments' data and models. The columns are described as followed:</li>
</ul>
<table>
<thead>
<tr><th style="text-align:center">Strat Table Column</th><th style="text-align:left">Purpose</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">unique_id</td><td style="text-align:left">A unique ID generated for each entry in this table.</td></tr>
<tr><td style="text-align:center">timestamp</td><td style="text-align:left">A timestamp indicating when a strategy was saved to the database, either because it finished or the server crashed. This column can be used to view the strategies chronologically.</td></tr>
<tr><td style="text-align:center">strat</td><td style="text-align:left">An AEPsych Strategy object, stored as a Python pickle for easy serialization/deserialization (This may change in the future as Python pickle objects may not load across versions of Python or AEPsych).</td></tr>
<tr><td style="text-align:center">master_table_id</td><td style="text-align:left">A reference key to the original entry in the master table's unique ID.</td></tr>
</tbody>
</table>
<ul>
<li><strong>config Table</strong>: This table stores saved AEPsych Configs, which store configuration data for each experiment, such as the number of trials, the type of data collected, the models used, etc. The columns are described as followed:</li>
</ul>
<table>
<thead>
<tr><th style="text-align:center">Config Table Column</th><th style="text-align:left">Purpose</th></tr>
</thead>
<tbody>
<tr><td style="text-align:center">unique_id</td><td style="text-align:left">A unique ID generated for each entry in this table.</td></tr>
<tr><td style="text-align:center">timestamp</td><td style="text-align:left">A timestamp indicating when the server received a setup message and created a Config object. This column can be used to view the Configs chronologically.</td></tr>
<tr><td style="text-align:center">config</td><td style="text-align:left">An AEPsych Config object, stored as a Python pickle for easy serialization/deserialization.  (This may change in the future as Python pickle objects may not load across versions of Python or AEPsych).</td></tr>
<tr><td style="text-align:center">master_table_id</td><td style="text-align:left">This is a reference key to the original entry in the master table's unique ID.</td></tr>
</tbody>
</table>
<p>The database schema is constantly evolving, so you may occasionally need to update old databases by running <code>python3 aepsych/server/server.py database --update --d database_path</code> from a command line. For more information about loading data and replaying previous experiments, see the <a href="https://github.com/facebookresearch/aepsych/tree/main/examples/example_db">example database and notebook</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/api_overview"><span class="arrow-prev">← </span><span>API Overview</span></a><a class="docs-next button" href="/docs/finish_criteria"><span>Advanced Strategy Configuration</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="AEPsych" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/introduction">Introduction</a><a href="/docs/getting_started">Getting Started</a><a href="/tutorials/">Tutorials</a><a href="/api/">API Reference</a></div><div><h5>Legal</h5><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener">Privacy</a><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener">Terms</a></div><div><div class="footerSection"><h5>Social</h5><div class="social"><a class="github-button" href="https://github.com/facebookresearch/aepsych" data-count-href="https://github.com/facebookresearch/aepsych/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star AEPsych on GitHub">aepsych</a></div></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2022 Meta, Inc.  Built with Docusaurus.</section><div class="cookie-container"><p>We use cookies to enhance your experience, and to analyse the use of our website. By clicking or navigating, you agree to allow our usage of cookies.</p><button class="cookie-btn">accept</button></div></footer></div></body></html>