<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The Ax Backend · AEPsych</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This page explains the features enabled by using the [Ax](https://ax.dev/) backend for AEPsych. This page follows the [example Ax config file](https://github.com/facebookresearch/aepsych/blob/main/configs/ax_example.ini). If you are not already familiar with AEPsych config files, you may wish to read [this page on basic config files](https://aepsych.org/docs/configs) and [this page on advanced config files](https://aepsych.org/docs/finish_criteria) first. To enable Ax features in AEPsych, you must specify `use_ax = True` under the `[common]` section of your config file. Note that while most of settings remain the same when using the Ax backend, the names of the models have changed. You should use `ContinuousRegressionGP` instead of `GPRegressionModel` and `BinaryClassificationGP` instead of `GPClassificationModel`."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="The Ax Backend · AEPsych"/><meta property="og:type" content="website"/><meta property="og:url" content="https://aepsych.org/"/><meta property="og:description" content="This page explains the features enabled by using the [Ax](https://ax.dev/) backend for AEPsych. This page follows the [example Ax config file](https://github.com/facebookresearch/aepsych/blob/main/configs/ax_example.ini). If you are not already familiar with AEPsych config files, you may wish to read [this page on basic config files](https://aepsych.org/docs/configs) and [this page on advanced config files](https://aepsych.org/docs/finish_criteria) first. To enable Ax features in AEPsych, you must specify `use_ax = True` under the `[common]` section of your config file. Note that while most of settings remain the same when using the Ax backend, the names of the models have changed. You should use `ContinuousRegressionGP` instead of `GPRegressionModel` and `BinaryClassificationGP` instead of `GPClassificationModel`."/><meta property="og:image" content="https://aepsych.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://aepsych.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/code_block_buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/cookie_consent.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/cookie_consent.js"></script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/static-logo.png" alt="AEPsych"/><h2 class="headerTitleWithLogo">AEPsych</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/demos/" target="_self">Demos</a></li><li class="siteNavGroupActive"><a href="/docs/introduction" target="_self">Docs</a></li><li class=""><a href="/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/api/" target="_self">API Reference</a></li><li class=""><a href="https://github.com/facebookresearch/aepsych" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Advanced topics</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">About</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/papers">Papers related to AEPsych</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">General</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting_started">Getting Started with the AEPsych service</a></li><li class="navListItem"><a class="navItem" href="/docs/configs">Writing Config Files</a></li><li class="navListItem"><a class="navItem" href="/docs/clients">AEPsych clients</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Background materials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/psychophysics_intro">A brief introduction to Psychophysics</a></li><li class="navListItem"><a class="navItem" href="/docs/gp_intro">A brief introduction to Gaussian Process active learning</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">For developers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/api_overview">API Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/db_overview">Database Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Advanced topics</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/finish_criteria">Advanced Strategy Configuration</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/ax_backend">The Ax Backend</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebookresearch/aepsych/blob/main/docs/ax_backend.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">The Ax Backend</h1></header><article><div><span><p>This page explains the features enabled by using the <a href="https://ax.dev/">Ax</a> backend for AEPsych. This page follows the <a href="https://github.com/facebookresearch/aepsych/blob/main/configs/ax_example.ini">example Ax config file</a>. If you are not already familiar with AEPsych config files, you may wish to read <a href="https://aepsych.org/docs/configs">this page on basic config files</a> and <a href="https://aepsych.org/docs/finish_criteria">this page on advanced config files</a> first. To enable Ax features in AEPsych, you must specify <code>use_ax = True</code> under the <code>[common]</code> section of your config file. Note that while most of settings remain the same when using the Ax backend, the names of the models have changed. You should use <code>ContinuousRegressionGP</code> instead of <code>GPRegressionModel</code> and <code>BinaryClassificationGP</code> instead of <code>GPClassificationModel</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="parameter-constraints"></a><a href="#parameter-constraints" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parameter Constraints</h2>
<p>Ax enables AEPsych to support linear parameter constraints using the par_constraints setting under common. These constraints take the form of a list of strings like <code>a*par1 + b*par2 &lt;= c</code>. In the example config we have <code>par_constraints = [par1 &gt;= par2]</code> to specify that the the first parameter must be greater than or equal to the second. We could add additional constraints such as
<code>par_constraints = [par1 &gt;= par2, 2*par - par3 &lt;= 0]</code>
but be aware that the more constraints you have, and the more complex those constraints are, the slower it will be to generate trials.</p>
<h2><a class="anchor" aria-hidden="true" id="discrete-choice-parameters--fixed-parameters"></a><a href="#discrete-choice-parameters--fixed-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Discrete Choice Parameters &amp; Fixed Parameters</h2>
<p>Parameters can now take discrete values instead of just continuous ones. To specify discrete choice parameters, you will first need to list the names of the parameters under the common section, as in the following taken from the example config:</p>
<pre><code class="hljs"><span class="hljs-section">[common]</span>
<span class="hljs-attr">choice_parnames</span> = [par4, par5]
</code></pre>
<p>You then need to specify sections for each of the parameters that list the possible values they can take, like so:</p>
<pre><code class="hljs"><span class="hljs-section">[par4]</span>
<span class="hljs-attr">choices</span> = [a, b]

<span class="hljs-section">[par5]</span>
<span class="hljs-attr">choices</span> = [low, med, high]
<span class="hljs-attr">is_ordered</span> = <span class="hljs-literal">True</span>
</code></pre>
<p>Note that the values of the discrete choice parameters should be strings. The <code>is_ordered = True</code> setting under <code>par5</code> indicates that the choices are ordered from lowest to highest (low &lt; med &lt; high). This setting should always be specified when possible because it simplifies the underlying model, yielding more accurate results and faster trials. If this setting is not specified, no ordering between values is assumed.
In a similar matter, you can also specify parameters that always take the same fixed values. For instance, the following specifies that <code>par6</code> and <code>par7</code> will always take the values <code>123</code>, and <code>&quot;placeholder&quot;</code>, respectively (fixed parameters can be either floats or strings).</p>
<pre><code class="hljs"><span class="hljs-section">[common]</span>
<span class="hljs-attr">fixed_parnames</span> = [par6, par7]

<span class="hljs-section">[par6]</span>
<span class="hljs-attr">value</span> = <span class="hljs-number">123</span>

<span class="hljs-section">[par7]</span>
<span class="hljs-attr">value</span> = placeholder
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="integer--log-scaled-parameters"></a><a href="#integer--log-scaled-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integer &amp; Log-scaled Parameters</h2>
<p>This update also enables new options for continuous parameters. You can now specify that a parameter should be an integer (rather than a float, by default) or you can specify that a parameter should be log-scaled, like so:</p>
<pre><code class="hljs"><span class="hljs-section">[common]</span>
<span class="hljs-attr">parnames</span> = [par1, par2, par3, par4]
<span class="hljs-attr">lb</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
<span class="hljs-attr">ub</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>]

<span class="hljs-section">[par1]</span>
<span class="hljs-attr">value_type</span> = int

<span class="hljs-section">[par4]</span>
<span class="hljs-attr">log_scale</span> = <span class="hljs-literal">True</span>
</code></pre>
<p>In this example, <code>par1</code> will always take an integer value from 0 to 10, and <code>par4</code> will be explored in log space from 1 to 100. This setting is useful when percentage increases are more impactful than absolute increases (i.e., the difference between 1 and 2--a 100% increase--is more important the difference between 10 and 11--a 10% increase). This setting should also be set to <code>True</code> when appropriate because it will help the model more efficiently explore the parameter space. Note, though, that log-scaled parameters cannot be used with parameter constraints because log-scaling is a nonlinear transformation.</p>
<h2><a class="anchor" aria-hidden="true" id="interactive-plots"></a><a href="#interactive-plots" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interactive Plots</h2>
<p>Another new feature enabled by this Ax integration is that we can make use of interactive Ax plots. Plots like the one below can be created by calling <code>server.strat.plot_contours()</code>. The plot shows both the mean and standard error of the predicted values throughout the parameter space. You can see the exact values at collected data points by hovering over them with the cursor, and you can select which parameters are plotted using the drop-down menus. You can fix the values of the un-plotted parameters by passing in a dictionary like <code>server.strat.plot_contours(slice_values={&quot;par3&quot;: 0.5})</code>.</p>
<p><img src="/docs/assets/ax_plot1.jpg" alt="Interactive Ax Plot"></p>
<p>Similarly, you can plot slices of single parameters using <code>server.strat.plot_contours(param_name=&quot;par1&quot;, slice_values={&quot;par2&quot;: 1.0, &quot;par3&quot;: 0.5})</code>.</p>
<p><img src="/docs/assets/ax_plot2.jpg" alt="Parameter Slice plot"></p>
<h2><a class="anchor" aria-hidden="true" id="aepsych-features-currently-incompatible-with-ax"></a><a href="#aepsych-features-currently-incompatible-with-ax" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AEPsych Features Currently Incompatible with Ax</h2>
<p>Rewriting AEPsych to be compatible with Ax was a huge undertaking, so not all of the old AEPsych features could be converted right away. As of right now, the following features do not currently work with the Ax backend:</p>
<ul>
<li>Plotting non-continuous outcomes (can still plot latent function)</li>
<li>Pairwise experiments</li>
<li>Setting a maximum generation time (trials may be slow w/o this)</li>
<li>Warm-start refitting (trials may be slow w/o this)</li>
<li>Using a model with Sobol sampling (useful for pure exploration, among other things)</li>
<li>Monotonicity constraints</li>
<li>Ordinal/Likert outcomes</li>
<li>Manually specifying points to sample via ManualGenerator (can still be done on the client side)</li>
</ul>
<p>All of these features should still work as long you do not specify <code>use_ax = True</code> in your config file. We plan on gradually implementing some of these features, and many of which will be more powerful with the Ax backend.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/finish_criteria"><span class="arrow-prev">← </span><span>Advanced Strategy Configuration</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#parameter-constraints">Parameter Constraints</a></li><li><a href="#discrete-choice-parameters--fixed-parameters">Discrete Choice Parameters &amp; Fixed Parameters</a></li><li><a href="#integer--log-scaled-parameters">Integer &amp; Log-scaled Parameters</a></li><li><a href="#interactive-plots">Interactive Plots</a></li><li><a href="#aepsych-features-currently-incompatible-with-ax">AEPsych Features Currently Incompatible with Ax</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="AEPsych" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/introduction">Introduction</a><a href="/docs/getting_started">Getting Started</a><a href="/tutorials/">Tutorials</a><a href="/api/">API Reference</a></div><div><h5>Legal</h5><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener">Privacy</a><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener">Terms</a></div><div><div class="footerSection"><h5>Social</h5><div class="social"><a class="github-button" href="https://github.com/facebookresearch/aepsych" data-count-href="https://github.com/facebookresearch/aepsych/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star AEPsych on GitHub">aepsych</a></div></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2024 Meta, Inc.  Built with Docusaurus.</section><div class="cookie-container"><p>We use cookies to enhance your experience, and to analyse the use of our website. By clicking or navigating, you agree to allow our usage of cookies.</p><button class="cookie-btn">accept</button></div></footer></div></body></html>